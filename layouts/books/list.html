{{ define "main" }}
<link rel="stylesheet" href="{{ "css/books.css" | relURL }}">
<link rel="stylesheet" href="{{ "css/books-widgets.css" | relURL }}">

{{/* ── Books Widgets ────────────────────────────────────── */}}
{{ with .Site.Data.books_widgets }}
<section class="books-widgets">

  {{/* ── Left: Currently Reading Carousel ── */}}
  {{ with .currently_reading }}
  <div class="widget widget-reading">
    <h3 class="widget-title">Currently Reading</h3>
    <div class="reading-carousel" aria-label="Currently reading carousel">
      <button class="carousel-arrow carousel-prev" aria-label="Previous book">&#8249;</button>
      <div class="carousel-track">
        {{ range . }}
        <div class="carousel-slide">
          <div class="carousel-cover">
            <img src="{{ .cover }}" alt="{{ .title }} cover" loading="lazy">
          </div>
          <div class="carousel-info">
            <span class="carousel-book-title">{{ .title }}</span>
            <span class="carousel-book-author">{{ .author }}</span>
            {{ if eq .format "audiobook" }}
            <span class="carousel-badge audiobook-badge">Audiobook</span>
            {{ else }}
            <span class="carousel-badge book-badge">Book</span>
            {{ end }}
          </div>
        </div>
        {{ end }}
      </div>
      <button class="carousel-arrow carousel-next" aria-label="Next book">&#8250;</button>
      <div class="carousel-dots">
        {{ range $i, $_ := . }}
        <button class="carousel-dot{{ if eq $i 0 }} active{{ end }}"
                aria-label="Go to slide {{ add $i 1 }}"
                data-index="{{ $i }}"></button>
        {{ end }}
      </div>
    </div>
  </div>
  {{ end }}

  {{/* ── Right: Recommendations Scroll ── */}}
  {{ with .recommendations }}
  <div class="widget widget-recommendations">
    <h3 class="widget-title">Recommendations</h3>
    <div class="recommendations-container">
      <button class="rec-arrow rec-prev" aria-label="Scroll up">&#8249;</button>
      <div class="recommendations-viewport" aria-label="Book recommendations">
        <ul class="recommendations-list">
          {{ range . }}
          <li class="recommendation-item">
            <a href="{{ .url }}">{{ .title }}</a>
          </li>
          {{ end }}
          {{/* Duplicate items for seamless infinite scroll */}}
          {{ range . }}
          <li class="recommendation-item" aria-hidden="true">
            <a href="{{ .url }}" tabindex="-1">{{ .title }}</a>
          </li>
          {{ end }}
        </ul>
      </div>
      <button class="rec-arrow rec-next" aria-label="Scroll down">&#8250;</button>
    </div>
  </div>
  {{ end }}

</section>
{{ end }}

<main>
  <h1>Books</h1>
  <div class="books-catalogue">
    {{ range (.Paginate .Pages).Pages }}
      {{ .Render "summary-books" }}
    {{ end }}
  </div>
  <div class="pagination">
    {{ if .Paginator.HasPrev }}
      <a href="{{ .Paginator.Prev.URL }}" class="left arrow">&#8592;</a>
    {{ end }}
    {{ if .Paginator.HasNext }}
      <a href="{{ .Paginator.Next.URL }}" class="right arrow">&#8594;</a>
    {{ end }}
    <span>{{ .Paginator.PageNumber }}</span>
  </div>
</main>

<script src="{{ "js/books-widgets.js" | relURL }}"></script>
{{ end }}
